[buildout]
parts+=
  worker1
  pyredis
  redis
  redis-server
  redis-conf

[redis]
recipe = hexagonit.recipe.cmmi
url=http://download.redis.io/releases/redis-4.0.10.tar.gz
configure-command = true
make-options =
    PREFIX=${buildout:parts-directory}/${:_buildout_section_name_}
    V=1
make-targets =
    install

[redis-server]
recipe = collective.recipe.template
input = templates/redis-start.in
output = bin/redis-start

[redis-conf]
recipe = collective.recipe.template
input = templates/redis.conf.in
output = etc/redis.conf

[redis-config]
host = 127.0.0.1
port = 6379
dir = ${buildout:directory}/var
logfile = stdout

[pyredis]
recipe = zc.recipe.egg:scripts
eggs = redis
interpreter = pyredis

[instance]
zope-conf-additional =
    %import collective.taskqueue
    <taskqueue>
       type redis
       unix_socket_path ${buildout:directory}/var/redis.sock
    </taskqueue>
    <taskqueue-server />
    
[instance1]
zope-conf-additional =
    %import collective.taskqueue
    <taskqueue>
      queue rer.newsletter.redis
      type redis
      unix_socket_path ${buildout:directory}/var/redis.sock
    </taskqueue>

[instance2]
zope-conf-additional =
    %import collective.taskqueue
    <taskqueue>
      queue rer.newsletter.redis
      type redis
      unix_socket_path ${buildout:directory}/var/redis.sock
    </taskqueue>
    
[worker1]
<= instance1
http-address = 8089
zope-conf-additional =
    %import collective.taskqueue
    <taskqueue>
      queue rer.newsletter.redis
      type redis
      unix_socket_path ${buildout:directory}/var/redis.sock
    </taskqueue>
    <taskqueue-server>
      queue rer.newsletter.redis
    </taskqueue-server>